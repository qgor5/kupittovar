<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Kupittovar — Інтернет-магазин з автоматичним завантаженням товарів</title>
<meta name="description" content="Інтернет-магазин з автоматичною загрузкою товарів з XML. Актуальні ціни, фото, опис. Легка корзина і зручне оформлення замовлення." />
<style>
  body { font-family: Arial, sans-serif; margin:0; padding:0; background:#f4f4f4; color:#333;}
  header, footer { background:#222; color:#eee; padding:15px 30px; }
  header nav a, footer a { color:#eee; margin-right:15px; text-decoration:none; }
  header nav a:hover, footer a:hover { text-decoration:underline; }
  .container { max-width: 1100px; margin: auto; padding: 20px; background:#fff; }
  h1, h2 { color:#222; }
  .products { display: flex; flex-wrap: wrap; gap: 15px; }
  .product { background: #fafafa; border: 1px solid #ddd; border-radius: 5px; width: calc(25% - 15px); box-sizing: border-box; padding: 10px; display: flex; flex-direction: column; }
  .product img { max-width: 100%; height: auto; border-radius: 5px; }
  .product-name { font-weight: bold; margin: 10px 0 5px; }
  .product-price { color: #c00; font-weight: bold; margin-bottom: 10px; }
  button { background: #28a745; color: #fff; border: none; padding: 8px; cursor: pointer; border-radius: 3px; }
  button:hover { background: #218838; }
  .cart-button { position: fixed; top: 20px; right: 20px; background: #007bff; padding: 10px 15px; border-radius: 5px; cursor: pointer; color: #fff; z-index: 1000; }
  .cart-button:hover { background: #0056b3; }
  /* Cart modal */
  #cartModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center; z-index: 1001; }
  #cartModal .cart-content { background: #fff; padding: 20px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; border-radius: 8px; position: relative; }
  #cartModal .close-cart { position: absolute; top: 10px; right: 15px; cursor: pointer; font-size: 24px; font-weight: bold; color: #999; }
  #cartModal .close-cart:hover { color: #333; }
  .cart-item { display: flex; margin-bottom: 15px; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
  .cart-item img { width: 80px; height: auto; margin-right: 15px; object-fit: contain; }
  .cart-item-info { flex: 1; }
  .cart-item-info h4 { margin: 0 0 5px; }
  .cart-item-info .price { color: #c00; font-weight: bold; }
  .cart-item-info .qty { margin-top: 5px; }
  .cart-item-remove { cursor: pointer; color: #c00; font-weight: bold; font-size: 18px; }
  form label { display: block; margin-top: 15px; }
  form input, form textarea { width: 100%; padding: 8px; margin-top: 5px; box-sizing: border-box; }
  form button { margin-top: 15px; }
</style>
</head>
<body>

<header>
  <nav>
    <a href="index.html">Головна</a>
    <a href="catalog.html">Каталог</a>
    <a href="blog.html">Блог</a>
    <a href="contact.html">Контакти</a>
  </nav>
</header>

<div class="container">
  <h1>Ласкаво просимо в Kupittovar</h1>
  <p>Інтернет-магазин з актуальними товарами, цінами та описом. Всі товари автоматично оновлюються з XML-файлу.</p>
  <h2>Популярні товари</h2>
  <div id="products" class="products">
    <!-- Товари тут підвантажуються JS -->
  </div>
</div>

<div class="cart-button" id="cartBtn">Кошик (0)</div>

<!-- Модальне вікно корзини -->
<div id="cartModal">
  <div class="cart-content">
    <span class="close-cart" id="closeCart">&times;</span>
    <h2>Кошик</h2>
    <div id="cartItems"></div>
    <h3>Всього: <span id="cartTotal">0 грн</span></h3>
    <button id="checkoutBtn">Оформити замовлення</button>
  </div>
</div>

<script>
const xmlUrl = 'https://www.websklad.biz.ua/wp-content/uploads/current-Universalnaya.xml'; // твій XML

let products = [];
let cart = JSON.parse(localStorage.getItem('cart')) || [];

const cartBtn = document.getElementById('cartBtn');
const cartModal = document.getElementById('cartModal');
const closeCartBtn = document.getElementById('closeCart');
const cartItemsDiv = document.getElementById('cartItems');
const cartTotalSpan = document.getElementById('cartTotal');
const productsDiv = document.getElementById('products');
const checkoutBtn = document.getElementById('checkoutBtn');

function formatPrice(price) {
  return price ? price.toLocaleString('uk-UA', {style: 'currency', currency: 'UAH'}) : '–';
}

// Завантаження XML через CORS proxy, т.к. исходный сервер блокирует прямой запрос из браузера
const corsProxy = 'https://api.allorigins.win/get?url=' + encodeURIComponent(xmlUrl);

async function loadProducts() {
  try {
    const res = await fetch(corsProxy);
    const data = await res.json();
    const parser = new DOMParser();
    const xmlDoc = parser.parseFromString(data.contents, "application/xml");
    const items = xmlDoc.querySelectorAll('item');
    products = [];
    items.forEach(item => {
      const id = item.querySelector('id')?.textContent || Math.random().toString(36).substr(2,9);
      const name = item.querySelector('name')?.textContent || 'Без назви';
      const price = parseFloat(item.querySelector('price')?.textContent.replace(',', '.')) || 0;
      const description = item.querySelector('description')?.textContent || '';
      const image = item.querySelector('image')?.textContent || '';
      products.push({id, name, price, description, image});
    });
    renderProducts();
  } catch(e) {
    productsDiv.innerHTML = '<p>Помилка завантаження товарів. Спробуйте пізніше.</p>';
    console.error(e);
  }
}

function renderProducts() {
  productsDiv.innerHTML = '';
  products.slice(0, 8).forEach(product => { // популярні — первые 8 товаров
    const productDiv = document.createElement('div');
    productDiv.className = 'product';
    productDiv.innerHTML = `
      <img src="${product.image}" alt="${product.name}" />
      <div class="product-name">${product.name}</div>
      <div class="product-price">${formatPrice(product.price)}</div>
      <button data-id="${product.id}">Додати в кошик</button>
    `;
    productsDiv.appendChild(productDiv);
  });
  // Добавляем обработчик добавления в корзину
  document.querySelectorAll('.product button').forEach(btn => {
    btn.addEventListener('click', () => {
      const id = btn.getAttribute('data-id');
      addToCart(id);
    });
  });
  updateCartCount();
}

function addToCart(id) {
  const product = products.find(p => p.id === id);
  if(!product) return;
  const cartItem = cart.find(c => c.id === id);
  if(cartItem) {
    cartItem.qty++;
  } else {
    cart.push({...product, qty:1});
  }
  localStorage.setItem('cart', JSON.stringify(cart));
  updateCartCount();
}

function updateCartCount() {
  const totalQty = cart.reduce((sum, item) => sum + item.qty, 0);
  cartBtn.textContent = `Кошик (${totalQty})`;
}

function renderCart() {
  cartItemsDiv.innerHTML = '';
  if(cart.length === 0) {
    cartItemsDiv.innerHTML = '<p>Кошик порожній</p>';
    cartTotalSpan.textContent = '0 грн';
    return;
  }
  let total = 0;
  cart.forEach(item => {
    total += item.price * item.qty;
    const itemDiv = document.createElement('div');
    itemDiv.className = 'cart-item';
    itemDiv.innerHTML = `
      <img src="${item.image}" alt="${item.name}" />
      <div class="cart-item-info">
        <h4>${item.name}</h4>
        <div class="price">${formatPrice(item.price)}</div>
        <div class="qty">Кількість: ${item.qty}</div>
      </div>
      <div class="cart-item-remove" data-id="${item.id}">&times;</div>
    `;
    cartItemsDiv.appendChild(itemDiv);
  });
  cartTotalSpan.textContent = formatPrice(total);

  // Удаление товара из корзины
  document.querySelectorAll('.cart-item-remove').forEach(btn => {
    btn.addEventListener('click', () => {
      const id = btn.getAttribute('data-id');
      cart = cart.filter(c => c.id !== id);
      localStorage.setItem('cart', JSON.stringify(cart));
      renderCart();
      updateCartCount();
    });
  });
}

// Показать/скрыть корзину
cartBtn.addEventListener('click', () => {
  renderCart();
  cartModal.style.display = 'flex';
});
closeCartBtn.addEventListener('click', () => {
  cartModal.style.display = 'none';
});
window.addEventListener('click', e => {
  if(e.target === cartModal) cartModal.style.display = 'none';
});

// Оформление заказа
checkoutBtn.addEventListener('click', () => {
  if(cart.length === 0) {
    alert('Кошик порожній!');
    return;
  }
  const orderDetails = cart.map(item => `${item.name} (x${item.qty}) — ${formatPrice(item.price * item.qty)}`).join('\n');
  const orderText = `Замовлення:\n${orderDetails}\n\nЗагальна сума: ${cartTotalSpan.textContent}`;
  // Здесь можно подключить форму отправки заказа на почту или SMS
  alert('Дякуємо за замовлення!\n\n' + orderText);
  cart = [];
  localStorage.removeItem('cart');
  updateCartCount();
  cartModal.style.display = 'none';
});

loadProducts();
</script>

<footer>
  <div class="container">
    <p>© 2025 Kupittovar. Ми в соцмережах: 
      <a href="https://youtube.com" target="_blank">YouTube</a>, 
      <a href="https://facebook.com" target="_blank">Facebook</a>, 
      <a href="https://instagram.com" target="_blank">Instagram</a>
    </p>
  </div>
</footer>

</body>
</html>
