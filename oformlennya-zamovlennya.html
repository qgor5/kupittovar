<script>
  // Получаем параметры из URL
  function getUrlParams() {
    const params = new URLSearchParams(window.location.search);
    return {
      name: params.get('name') || 'Товар',
      price: parseFloat(params.get('price')) || 0,
      qty: parseInt(params.get('qty')) || 1,
      image: params.get('image') || ''
    };
  }

  // Обновляем URL без перезагрузки страницы
  function updateUrlParams() {
    const params = new URLSearchParams(window.location.search);
    params.set('qty', productData.qty);
    const newUrl = window.location.pathname + '?' + params.toString();
    history.replaceState(null, '', newUrl);
  }

  // Обновляем показ товара и цен
  function updateDisplay() {
    const total = (productData.price * productData.qty).toFixed(2);
    document.getElementById('product-name').textContent = productData.name;
    document.getElementById('product-price').textContent = productData.price.toFixed(2);
    document.getElementById('quantity-input').value = productData.qty;
    document.getElementById('total-price').textContent = total;
    document.getElementById('product-image').src = productData.image;
    document.getElementById('product-image').alt = `Фото товару: ${productData.name}`;
    
    updateUrlParams();
  }

  const productData = getUrlParams();
  updateDisplay();

  // Кнопки +/- количества
  document.getElementById('decrease-qty').addEventListener('click', () => {
    if (productData.qty > 1) {
      productData.qty--;
      updateDisplay();
    }
  });

  document.getElementById('increase-qty').addEventListener('click', () => {
    productData.qty++;
    updateDisplay();
  });

  // Ввод количества вручную
  document.getElementById('quantity-input').addEventListener('input', (e) => {
    let val = parseInt(e.target.value);
    if (isNaN(val) || val < 1) val = 1;
    productData.qty = val;
    updateDisplay();
  });

  // Обработка формы (ваш существующий код)
  const form = document.getElementById('order-form');
  const loader = document.querySelector('.loader');
  const message = document.querySelector('.message');
  const backToCart = document.querySelector('.back-to-cart');

  form.addEventListener('submit', e => {
    e.preventDefault();

    if (!form.checkValidity()) {
      form.reportValidity();
      return;
    }

    loader.style.display = 'block';
    message.style.display = 'none';
    backToCart.style.display = 'none';

    setTimeout(() => {
      loader.style.display = 'none';
      message.textContent = 'Замовлення прийнято! Дякуємо!';
      message.style.display = 'block';
      backToCart.style.display = 'block';

      form.querySelectorAll('input, button').forEach(el => el.disabled = true);
    }, 2000);
  });
</script>
