<!-- Вверху блока с товаром -->
<div id="order-summary">
  <img id="product-image" src="" alt="Фото товару" style="max-width: 150px;">
  <h2 id="product-title"></h2>
  <div>
    Кількість: 
    <button id="qty-decrease">−</button>
    <input type="number" id="product-qty" value="1" min="1" style="width: 40px;">
    <button id="qty-increase">+</button>
  </div>
  <p>Ціна за одиницю: <span id="product-price"></span> грн</p>
  <p>Загальна сума: <span id="total-price"></span> грн</p>
</div>

<!-- Форма замовлення -->
<form id="order-form">
  <!-- ПІБ, телефон, адреса, інші поля -->
  <input type="text" id="fullname" name="fullname" placeholder="ПІБ" required>
  <input type="tel" id="phone" name="phone" placeholder="Телефон" required>
  <input type="text" id="address" name="address" placeholder="Адреса" required>
  <button type="submit">Підтвердити замовлення</button>
</form>

<script>
  // Функція отримання параметрів з URL
  function getUrlParams() {
    const params = new URLSearchParams(window.location.search);
    return {
      img: params.get('img'),
      title: params.get('title'),
      price: parseFloat(params.get('price')),
      qty: parseInt(params.get('qty')) || 1,
    };
  }

  // Ініціалізація сторінки
  const productImage = document.getElementById('product-image');
  const productTitle = document.getElementById('product-title');
  const productPrice = document.getElementById('product-price');
  const totalPrice = document.getElementById('total-price');
  const qtyInput = document.getElementById('product-qty');
  const qtyDecrease = document.getElementById('qty-decrease');
  const qtyIncrease = document.getElementById('qty-increase');

  const orderForm = document.getElementById('order-form');

  const product = getUrlParams();

  // Відобразити товар
  productImage.src = product.img || '';
  productImage.alt = product.title || 'Фото товару';
  productTitle.textContent = product.title || 'Товар';
  productPrice.textContent = product.price ? product.price.toFixed(2) : '0.00';
  qtyInput.value = product.qty;

  // Функція оновлення загальної суми
  function updateTotal() {
    let qty = parseInt(qtyInput.value);
    if (isNaN(qty) || qty < 1) qty = 1;
    qtyInput.value = qty;
    const total = product.price * qty;
    totalPrice.textContent = total.toFixed(2);
  }

  // Обробники кнопок +/- для кількості
  qtyDecrease.addEventListener('click', () => {
    let currentQty = parseInt(qtyInput.value);
    if (currentQty > 1) {
      qtyInput.value = currentQty - 1;
      updateTotal();
    }
  });

  qtyIncrease.addEventListener('click', () => {
    let currentQty = parseInt(qtyInput.value);
    qtyInput.value = currentQty + 1;
    updateTotal();
  });

  qtyInput.addEventListener('input', () => {
    updateTotal();
  });

  updateTotal();

  // Обробник відправки форми
  orderForm.addEventListener('submit', function(e) {
    e.preventDefault();

    // Валідація (можна додати додаткову)

    const formData = new FormData(orderForm);
    formData.append('product_title', productTitle.textContent);
    formData.append('product_qty', qtyInput.value);
    formData.append('product_price', productPrice.textContent);
    formData.append('total_price', totalPrice.textContent);
    formData.append('product_image', productImage.src);

    // Надсилання даних на Formspree або інший бекенд
    fetch('https://formspree.io/f/YOUR_FORM_ID', {
      method: 'POST',
      body: formData,
      headers: {
        'Accept': 'application/json'
      }
    }).then(response => {
      if (response.ok) {
        // Перенаправлення після успішного замовлення
        window.location.href = 'https://kupittovar.netlify.app/order-success.html';
      } else {
        alert('Помилка при відправці замовлення. Спробуйте ще раз.');
      }
    }).catch(() => {
      alert('Помилка мережі. Спробуйте ще раз.');
    });
  });
</script>
