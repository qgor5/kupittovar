<!DOCTYPE html>
<html lang="uk">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Оформлення замовлення – Кожані ремінці NATO</title>
<style>
  body {
    font-family: Arial, sans-serif;
    max-width: 600px;
    margin: 30px auto;
    padding: 15px;
    background: #fff;
    color: #222;
    line-height: 1.5;
  }
  h1 {
    text-align: center;
    color: #0055aa;
    margin-bottom: 1em;
  }
  form {
    display: flex;
    flex-direction: column;
    gap: 18px;
  }
  label {
    font-weight: bold;
    margin-bottom: 6px;
    display: block;
  }
  input[type="text"],
  input[type="tel"],
  select,
  textarea,
  input[type="number"] {
    width: 100%;
    padding: 8px;
    font-size: 1em;
    border: 2px solid #ccc;
    border-radius: 6px;
    box-sizing: border-box;
    transition: border-color 0.3s;
  }
  input[type="text"]:focus,
  input[type="tel"]:focus,
  select:focus,
  textarea:focus,
  input[type="number"]:focus {
    border-color: #0077ff;
    outline: none;
  }
  .error-message {
    color: #cc3300;
    font-size: 0.9em;
    margin-top: 4px;
  }
  .delivery-toggle {
    font-weight: normal;
    margin-bottom: 6px;
  }
  .delivery-options {
    margin-left: 15px;
    margin-top: 8px;
  }
  .product-info {
    display: flex;
    gap: 20px;
    align-items: center;
    margin-bottom: 20px;
    border-bottom: 1px solid #ccc;
    padding-bottom: 12px;
  }
  .product-info img {
    width: 120px;
    height: 80px;
    object-fit: cover;
    border-radius: 6px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  }
  .product-details {
    flex-grow: 1;
  }
  .product-details h2 {
    margin: 0 0 6px 0;
    color: #0077ff;
    font-size: 1.2em;
  }
  .product-details p {
    margin: 4px 0;
    font-size: 1em;
  }
  .qty-price {
    margin-top: 8px;
  }
  button {
    background-color: #009944;
    color: white;
    font-weight: bold;
    font-size: 1.1em;
    padding: 14px;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    transition: background-color 0.3s;
  }
  button:hover {
    background-color: #007733;
  }
</style>
</head>
<body>

<h1>Оформлення замовлення</h1>

<form id="order-form" method="POST" action="https://formsubmit.co/elits485@gmail.com" novalidate>
  <div class="product-info" aria-label="Інформація про товар">
    <img id="product-image" src="" alt="Фото товару" />
    <div class="product-details">
      <h2 id="product-name"></h2>
      <p>Ціна за одиницю: <span id="product-price"></span> грн</p>
      <label for="qty">Кількість:</label>
      <input type="number" id="qty" name="qty" min="1" value="1" required />
      <p class="qty-price">Загальна ціна: <strong id="total-price"></strong> грн</p>
    </div>
  </div>

  <label for="fullName">Повне ім’я *</label>
  <input type="text" id="fullName" name="fullName" required />
  <div class="error-message" id="error-fullName"></div>

  <label for="phone">Телефон *</label>
  <input type="tel" id="phone" name="phone" pattern="^\+?\d{7,15}$" placeholder="+380XXXXXXXXX" required />
  <div class="error-message" id="error-phone"></div>

  <label>Виберіть службу доставки *</label>
  <div class="delivery-toggle" role="radiogroup" aria-labelledby="delivery-label">
    <label><input type="radio" name="deliveryService" value="Укрпошта" required /> Укрпошта</label><br />
    <label><input type="radio" name="deliveryService" value="Нова пошта" /> Нова пошта</label>
  </div>
  <div class="error-message" id="error-deliveryService"></div>

  <div id="ukrposhta-fields" style="display:none; margin-top:10px;">
    <label for="ukrIndex">Індекс *</label>
    <input type="text" id="ukrIndex" name="ukrIndex" pattern="^\d{5}$" placeholder="12345" />
    <div class="error-message" id="error-ukrIndex"></div>

    <label for="ukrCity">Місто *</label>
    <input type="text" id="ukrCity" name="ukrCity" />
    <div class="error-message" id="error-ukrCity"></div>

    <label for="ukrStreet">Вулиця *</label>
    <input type="text" id="ukrStreet" name="ukrStreet" />
    <div class="error-message" id="error-ukrStreet"></div>
  </div>

  <div id="novaposhta-fields" style="display:none; margin-top:10px;">
    <label for="npRegion">Область *</label>
    <input type="text" id="npRegion" name="npRegion" />
    <div class="error-message" id="error-npRegion"></div>

    <label for="npCity">Місто *</label>
    <input type="text" id="npCity" name="npCity" />
    <div class="error-message" id="error-npCity"></div>

    <label for="npBranch">Номер відділення *</label>
    <input type="text" id="npBranch" name="npBranch" />
    <div class="error-message" id="error-npBranch"></div>
  </div>

  <label for="color">Виберіть колір ремінця *</label>
  <select id="color" name="color" required>
    <option value="">-- Оберіть колір --</option>
    <option value="Коричневий">Коричневий</option>
    <option value="Зелений">Зелений</option>
    <option value="Червоний">Червоний</option>
    <option value="Чорний">Чорний</option>
  </select>
  <div class="error-message" id="error-color"></div>

  <label for="comments">Коментарі (необов’язково)</label>
  <textarea id="comments" name="comments" rows="3" placeholder="Ваші побажання або питання"></textarea>

  <input type="hidden" name="_captcha" value="false" />
  <input type="hidden" name="_template" value="table" />

  <button type="submit">Підтвердити замовлення</button>
</form>

<script>
  // Подтягиваем параметры из URL (qty, name, price, image)
  function getUrlParams() {
    const params = new URLSearchParams(window.location.search);
    return {
      qty: params.get('qty') || '1',
      name: params.get('name') || '',
      price: params.get('price') || '0',
      image: params.get('image') || '',
    };
  }

  function updateTotalPrice() {
    const qtyInput = document.getElementById('qty');
    const price = parseFloat(product.price);
    let qty = parseInt(qtyInput.value);
    if (isNaN(qty) || qty < 1) qty = 1;
    qtyInput.value = qty;
    const totalPrice = (qty * price).toFixed(2);
    document.getElementById('total-price').textContent = totalPrice;
  }

  function showDeliveryFields() {
    const ukrFields = document.getElementById('ukrposhta-fields');
    const npFields = document.getElementById('novaposhta-fields');
    const selected = document.querySelector('input[name="deliveryService"]:checked');
    if (!selected) {
      ukrFields.style.display = 'none';
      npFields.style.display = 'none';
      return;
    }
    if (selected.value === 'Укрпошта') {
      ukrFields.style.display = 'block';
      npFields.style.display = 'none';
      // required fields for Ukrposhta
      document.getElementById('ukrIndex').required = true;
      document.getElementById('ukrCity').required = true;
      document.getElementById('ukrStreet').required = true;
      document.getElementById('npRegion').required = false;
      document.getElementById('npCity').required = false;
      document.getElementById('npBranch').required = false;
    } else if (selected.value === 'Нова пошта') {
      ukrFields.style.display = 'none';
      npFields.style.display = 'block';
      // required fields for Nova Poshta
      document.getElementById('ukrIndex').required = false;
      document.getElementById('ukrCity').required = false;
      document.getElementById('ukrStreet').required = false;
      document.getElementById('npRegion').required = true;
      document.getElementById('npCity').required = true;
      document.getElementById('npBranch').required = true;
    }
  }

  function clearErrors() {
    document.querySelectorAll('.error-message').forEach(el => el.textContent = '');
  }

  function validateForm() {
    clearErrors();
    let valid = true;

    // Full Name
    const fullName = document.getElementById('fullName');
    if (!fullName.value.trim()) {
      document.getElementById('error-fullName').textContent = 'Введіть повне ім’я.';
      valid = false;
    }

    // Phone (simple pattern check)
    const phone = document.getElementById('phone');
    const phoneRegex = /^\+?\d{7,15}$/;
    if (!phone.value.trim()) {
      document.getElementById('error-phone').textContent = 'Введіть телефон.';
      valid = false;
    } else if (!phoneRegex.test(phone.value.trim())) {
      document.getElementById('error-phone').textContent = 'Невірний формат телефону.';
      valid = false;
    }

    // Delivery service
    const delivery = document.querySelector('input[name="deliveryService"]:checked');
    if (!delivery) {
      document.getElementById('error-deliveryService').textContent = 'Оберіть службу доставки.';
      valid = false;
    } else if (delivery.value === 'Укрпошта') {
      // validate Ukrposhta fields
      const ukrIndex = document.getElementById('ukrIndex');
      const ukrCity = document.getElementById('ukrCity');
      const ukrStreet = document.getElementById('ukrStreet');
      const ukrIndexRegex = /^\d{5}$/;

      if (!ukrIndex.value.trim()) {
        document.getElementById('error-ukrIndex').textContent = 'Введіть індекс.';
        valid = false;
      } else if (!ukrIndexRegex.test(ukrIndex.value.trim())) {
        document.getElementById('error-ukrIndex').textContent = 'Індекс має бути 5 цифр.';
        valid = false;
      }
      if (!ukrCity.value.trim()) {
        document.getElementById('error-ukrCity').textContent = 'Введіть місто.';
        valid = false;
      }
      if (!ukrStreet.value.trim()) {
        document.getElementById('error-ukrStreet').textContent = 'Введіть вулицю.';
        valid = false;
      }
    } else if (delivery.value === 'Нова пошта') {
      // validate Nova Poshta fields
      const npRegion = document.getElementById('npRegion');
      const npCity = document.getElementById('npCity');
      const npBranch = document.getElementById('npBranch');

      if (!npRegion.value.trim()) {
        document.getElementById('error-npRegion').textContent = 'Введіть область.';
        valid = false;
      }
      if (!npCity.value.trim()) {
        document.getElementById('error-npCity').textContent = 'Введіть місто.';
        valid = false;
      }
      if (!npBranch.value.trim()) {
        document.getElementById('error-npBranch').textContent = 'Введіть номер відділення.';
        valid = false;
      }
    }

    // Color
    const color = document.getElementById('color');
    if (!color.value) {
      document.getElementById('error-color').textContent = 'Оберіть колір ремінця.';
      valid = false;
    }

    // Quantity
    const qty = document.getElementById('qty');
    if (qty.value < 1) {
      alert('Кількість має бути не меншою за 1');
      valid = false;
    }

    return valid;
  }

  // При выборе службы доставки показываем нужные поля
  document.querySelectorAll('input[name="deliveryService"]').forEach(radio => {
    radio.addEventListener('change', showDeliveryFields);
  });

  // При изменении количества пересчитываем цену
  document.getElementById('qty').addEventListener('input', updateTotalPrice);

  // Подстановка параметров и инициализация
  const product = getUrlParams();
  document.getElementById('product-name').textContent = product.name;
  document.getElementById('product-price').textContent = parseFloat(product.price).toFixed(2);
  document.getElementById('product-image').src = product.image || 'https://raw.githubusercontent.com/qgor5/kupittovar/refs/heads/main/Leather-Watch-Straps.webp';
  document.getElementById('product-image').alt = `Фото товару: ${product.name}`;
  document.getElementById('qty').value = product.qty || 1;
  updateTotalPrice();
  showDeliveryFields();

  // Обработка отправки формы
  document.getElementById('order-form').addEventListener('submit', function(event) {
    event.preventDefault();
    if (!validateForm()) return;

    const form = this;
    const url = form.action;
    const formData = new FormData(form);

    fetch(url, {
      method: 'POST',
      body: formData,
      headers: { 'Accept': 'application/json' },
    })
    .then(response => {
      if (response.ok) {
        window.location.href = 'order-success.html';
      } else {
        alert('Сталася помилка при відправці. Спробуйте ще раз.');
      }
    })
    .catch(() => {
      alert('Сталася помилка при відправці. Спробуйте ще раз.');
    });
  });
</script>

</body>
</html>
